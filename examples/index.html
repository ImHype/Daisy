<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Daisy - TodoList</title>
        <style media="screen">
            body {
                margin: 0;
                padding: 0;
            }

            .header {
                padding: 30px;
                background: #f2f2f2;
                text-align: center;
                font-family: fantasy

            }

            .header h1 {
                color: #c13164;
                font-size: 40px;
            }

            .header h2 {
                color: #333;
                font-size: 20px;
            }

            .body {
                max-width: 800px;
                margin: 0 auto;
                margin-top: 20px;
            }

            .body, .body li{
                list-style: none;
                padding: 0
            }

            .body li p{
                background-color: #f2f2f2;
                margin: 5px 0;
                padding: 10px 0;
                text-indent: 10px;
                font-family: monospace;
                font-size: 13px;
            }

        </style>
    </head>
    <body>
        <div id="node"></div>

        <script type="text/javascript" src="/dist/daisy.js"></script>
        <script type="text/javascript">
            Daisy = Daisy.default;
            class Component extends Daisy {
                get initialState() {
                    return {
                        todoList: [
                            {
                                name: 'ast -> virtual nodes 2017-10-3',
                                status: true
                            }, {
                                name: 'virtual dom 2017-10-4',
                                status: false
                            }, {
                                name: 'events 2017-10-5',
                                status: false
                            }, {
                                name: 'directive 2017-10-6',
                                status: false
                            }, {
                                name: 'component 2017-10-7',
                                status: false
                            }
                        ]
                    }
                }
                get template() {
                    return `
                        <header class="header">
                            <h1>Daisy</h1>
                            <h2>TodoList</h2>
                        </header>
                        <block :if = "{{todoList.length > 0}}">
                            <ul class="body">
                                <li :for={{todoList}} :for-item={{todo}} :for-index={{todoIndex}}
                                    @on-click={{this.onButtonClick(todo, todoIndex)}}
                                >
                                    <p> <input 
                                        type="checkbox" 
                                        checked={{todo.status === true}}> {{todo.name}}

                                        <button @on-click={{this.onDelete(e, todoIndex)}}>delete</button>
                                    </p>
                                </li>
                            </ul>
                        </block>
                        <block :else>
                            <ul class = "body">
                                <li>
                                    <p>No TodoList!</p>
                                </li>
                            </ul>
                        </block>

                        <div style="text-align: center;">
                            <button type="button" @on-click={{this.onReset()}}>重置</button>
                        </div>
                    `
                }
                constructor(options) {
                    super(options);
                }
                beforeMounted() {
                    console.log('-- beforeMounted --');
                }
                afterMounted() {
                    console.log('-- afterMounted --');
                }
                beforePatched() {
                    console.log('-- beforePatched --');
                }
                afterPatched() {
                    console.log('-- afterPatched --');
                }
                onButtonClick(todo, index) {
                    const todoList = this.getState().todoList;
                    todoList[index].status = !todoList[index].status
                    this.setState({
                        todoList: todoList
                    });
                }
                onReset() {
                    this.setState({
                        todoList: this.initialState.todoList
                    });
                }
                onDelete(e, index) {
                    const todoList = this.getState().todoList;
                    this.setState({
                        todoList: [
                            ...todoList.slice(0, index),
                            ...todoList.slice(index, todoList.length - 1)
                        ]
                    });
                    e.stopPropagation();  
                }
            }

            Daisy.method('DaisyMethod', (b) => {
                return 'DaisyMethod';
            });

            Component.method('ComponentMethod', (status) => {
                return status === 0 ? '进行中' : '已完成';
            });

            Component.directive('on-click', (elem, binding, vnode) => {
                const doSomthing = (e) => {
                    binding.expression({
                        e
                    });
                };

                elem.addEventListener('click', doSomthing);
                return () => {
                    elem.addEventListener('click', doSomthing); 
                }
            });

            new Component({
                state: {}
            }).mount(document.querySelector('#node'));

        </script>
    </body>
</html>
